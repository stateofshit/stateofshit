<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>STATE OF SHIT</title>
  <style>
    :root { color-scheme: dark light }
    html, body { height: 100% }
    body { margin: 0; background: #0b0f12; color: #c8d0d8; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; line-height: 1.6 }
    header { position: sticky; top: 0; backdrop-filter: blur(6px); background: #0b0f12cc; border-bottom: 1px solid #0f1a23 }
    .wrap { max-width: 1000px; margin: 0 auto; padding: .8rem 1rem }
    .brand { color: #7ee787; font-weight: 700; letter-spacing: .5px }
    .muted { color: #8aa1b2 }
    a { color: #7dcfff; text-decoration: none }
    a.button { color: #c8d0d8; border: 1px solid #1f2a33; background: #11181f; padding: .35rem .6rem; border-radius: 6px }
    a.button:hover { background: #17212a }
    main { max-width: 1000px; margin: 1rem auto 3rem; padding: 0 1rem }
    pre { background: #0f1720; border: 1px solid #13202b; padding: .75rem 1rem; border-radius: 8px; overflow: auto }
    code { font-family: inherit }
    h1, h2, h3 { color: #9fe3a0 }
    .toolbar { display:flex; gap:.6rem; align-items:center }
    .dot { width:9px; height:9px; background:#22c55e; border-radius:50%; display:inline-block; margin-right:.4rem }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="toolbar">
        <div class="brand">STATE OF SHIT</div>
        <span style="flex:1"></span>
        <a class="button" href="/archive/">Archive</a>
        <a class="button" href="https://stateofshit.rest">API</a>
        <span class="muted" id="updated"><span class="dot"></span>loading…</span>
        <a class="button" href="/STATEOFSHIT.md">Raw</a>
        <a class="button" id="refresh" href="#">Refresh</a>
      </div>
    </div>
  </header>
  <main id="app">Loading…</main>
  <script src="/assets/marked.min.js"></script>
  <script>
    const mdPath = 'STATEOFSHIT.md';
    let lastText = '';
    async function render(text){
      const html = marked.parse(text, { mangle:false, headerIds:true });
      const app = document.getElementById('app');
      app.innerHTML = html;
      const m = text.match(/Entry:\s*(.*)/);
      document.getElementById('updated').childNodes[1].textContent = m ? `Updated ${m[1]}` : 'Updated';
    }
    async function load(force=false){
      try {
        const res = await fetch(mdPath + (force ? `?t=${Date.now()}`:''), { cache: 'no-cache' });
        const text = await res.text();
        if (force || text !== lastText) { lastText = text; await render(text); }
      } catch (e) {
        document.getElementById('app').textContent = 'Failed to load STATEOFSHIT.md';
        document.getElementById('updated').textContent = 'Offline';
      }
    }
    document.getElementById('refresh').addEventListener('click', (e) => { e.preventDefault(); load(true); });
    load(true);
    setInterval(load, 60000);
  </script>
</body>
</html>
